<!DOCTYPE HTML>
<html>

<head>
	<title>Segment AnalyticsJS Sandbox</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<div class="logo">
				<span class="icon fa-gem"></span>
			</div>
			<div class="content">
				<div class="inner">
					<h1>{ Analytics.JS Sandbox }</h1>
					<p>Website to test various scenarios with Segment's <a
							href="https://segment.com/docs/connections/sources/catalog/libraries/website/javascript/"
							target="_BLANK">analytics.js</a> library.<br />
						All content presented here is awesome PM code so please don't try to use this in production ðŸ’š
					</p>
				</div>
			</div>
			<nav>
				<ul>
					<li><input type="submit" value="init()" class="primary" id="initialize-button" /></li>
					<li><span class="icon">|</span></li>
					<li><input type="submit" value="page()" class="primary" id="page-button" /></li>
					<li><span class="icon">|</span></li>
					<li><input type="submit" value="identify_a()" class="primary" id="identify-a-button" /></li>
					<li><span class="icon">|</span></li>
					<li><input type="submit" value="track()" class="primary" id="track-button" /></li>
					<li><span class="icon">|</span></li>
					<li><input type="submit" value="identify_generate_new_user()" class="primary" id="identify-b-button" /></li>
					<li><span class="icon">|</span></li>
					<li><input type="submit" value="reset()" class="primary" id="reset-button" /></li>
				</ul>
			</nav>
		</header>

		<!-- Footer -->
		<footer id="footer">
			<p class="copyright" id="status">AJS uninitialized</p>
		</footer>

	</div>

	<!-- BG -->
	<div id="bg"></div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<!-- Analytics Scripts -->
	<script type="text/javascript" async="" src="https://js.appboycdn.com/web-sdk/2.4/appboy.min.js"></script>
	<script type="text/javascript">
		function logger(message) {
			console.log(message);
			document.getElementById('status').innerText += `\n${new Date().toLocaleTimeString()}: ${message}`;
			return;
		}
		function guid() {
			function s4() {
				return Math.floor((1 + Math.random()) * 0x10000)
					.toString(16)
					.substring(1);
			}
			return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
				s4() + '-' + s4() + s4() + s4();
		}
		const writeKey = 'JoOEm07fcP1I8rJZpJLJUHWKY4PeCY5f';
		const brazeKey = '59023613-ab90-427f-8d4b-58504cfce282';
		var initializeButton = document.getElementById("initialize-button");
		var trackButton = document.getElementById("track-button");
		var identifyAButton = document.getElementById("identify-a-button");
		var pageButton = document.getElementById("page-button");
		var resetButton = document.getElementById("reset-button");
		var identifyBButton = document.getElementById("identify-b-button");

		initializeButton.onclick = (e) => {
			e.preventsDefault;
			!(function () {
				var analytics = (window.analytics = window.analytics || []);
				if (!analytics.initialize)
					if (analytics.invoked)
						window.console &&
							console.error &&
							console.error("Segment snippet included twice.");
					else {
						analytics.invoked = !0;
						analytics.methods = [
							"trackSubmit",
							"trackClick",
							"trackLink",
							"trackForm",
							"pageview",
							"identify",
							"reset",
							"group",
							"track",
							"ready",
							"alias",
							"debug",
							"page",
							"once",
							"off",
							"on"
						];
						analytics.factory = function (t) {
							return function () {
								var e = Array.prototype.slice.call(arguments);
								e.unshift(t);
								analytics.push(e);
								return analytics;
							};
						};
						for (var t = 0; t < analytics.methods.length; t++) {
							var e = analytics.methods[t];
							analytics[e] = analytics.factory(e);
						}
						analytics.load = function (t, e) {
							var n = document.createElement("script");
							n.type = "text/javascript";
							n.async = !0;
							n.src =
								"https://cdn.segment.com/analytics.js/v1/" +
								t +
								"/analytics.min.js";
							var a = document.getElementsByTagName("script")[0];
							a.parentNode.insertBefore(n, a);
							analytics._loadOptions = e;
						};
						analytics.SNIPPET_VERSION = "4.1.0";
						analytics.load(writeKey);
					}
			})();
			logger(`AJS initialized with write key: ${writeKey}`);
			+function (a, p, P, b, y) {
			a.appboy = {}; a.appboyQueue = []; for (var s = "initialize destroy getDeviceId toggleAppboyLogging setLogger openSession changeUser requestImmediateDataFlush requestFeedRefresh subscribeToFeedUpdates requestContentCardsRefresh subscribeToContentCardsUpdates logCardImpressions logCardClick logCardDismissal logFeedDisplayed logContentCardsDisplayed logInAppMessageImpression logInAppMessageClick logInAppMessageButtonClick logInAppMessageHtmlClick subscribeToNewInAppMessages subscribeToInAppMessage removeSubscription removeAllSubscriptions logCustomEvent logPurchase isPushSupported isPushBlocked isPushGranted isPushPermissionGranted registerAppboyPushMessages unregisterAppboyPushMessages trackLocation stopWebTracking resumeWebTracking wipeData ab ab.DeviceProperties ab.User ab.User.Genders ab.User.NotificationSubscriptionTypes ab.User.prototype.getUserId ab.User.prototype.setFirstName ab.User.prototype.setLastName ab.User.prototype.setEmail ab.User.prototype.setGender ab.User.prototype.setDateOfBirth ab.User.prototype.setCountry ab.User.prototype.setHomeCity ab.User.prototype.setLanguage ab.User.prototype.setEmailNotificationSubscriptionType ab.User.prototype.setPushNotificationSubscriptionType ab.User.prototype.setPhoneNumber ab.User.prototype.setAvatarImageUrl ab.User.prototype.setLastKnownLocation ab.User.prototype.setUserAttribute ab.User.prototype.setCustomUserAttribute ab.User.prototype.addToCustomAttributeArray ab.User.prototype.removeFromCustomAttributeArray ab.User.prototype.incrementCustomUserAttribute ab.User.prototype.addAlias ab.User.prototype.setCustomLocationAttribute ab.InAppMessage ab.InAppMessage.SlideFrom ab.InAppMessage.ClickAction ab.InAppMessage.DismissType ab.InAppMessage.OpenTarget ab.InAppMessage.ImageStyle ab.InAppMessage.TextAlignment ab.InAppMessage.Orientation ab.InAppMessage.CropType ab.InAppMessage.prototype.subscribeToClickedEvent ab.InAppMessage.prototype.subscribeToDismissedEvent ab.InAppMessage.prototype.removeSubscription ab.InAppMessage.prototype.removeAllSubscriptions ab.InAppMessage.prototype.closeMessage ab.InAppMessage.Button ab.InAppMessage.Button.prototype.subscribeToClickedEvent ab.InAppMessage.Button.prototype.removeSubscription ab.InAppMessage.Button.prototype.removeAllSubscriptions ab.SlideUpMessage ab.ModalMessage ab.FullScreenMessage ab.HtmlMessage ab.ControlMessage ab.Feed ab.Feed.prototype.getUnreadCardCount ab.ContentCards ab.ContentCards.prototype.getUnviewedCardCount ab.Card ab.Card.prototype.dismissCard ab.ClassicCard ab.CaptionedImage ab.Banner ab.ControlCard ab.WindowUtils display display.automaticallyShowNewInAppMessages display.showInAppMessage display.showFeed display.destroyFeed display.toggleFeed display.showContentCards display.hideContentCards display.toggleContentCards sharedLib".split(" "), i = 0; i < s.length; i++) { for (var m = s[i], k = a.appboy, l = m.split("."), j = 0; j < l.length - 1; j++)k = k[l[j]]; k[l[j]] = (new Function("return function " + m.replace(/\./g, "_") + "(){window.appboyQueue.push(arguments); return true}"))() } window.appboy.getUser = function () { return new window.appboy.ab.User }; window.appboy.getCachedFeed = function () { return new window.appboy.ab.Feed }; window.appboy.getCachedContentCards = function () { return new window.appboy.ab.ContentCards }; (y = p.createElement(P)).type = 'text/javascript';
				y.src = 'https://js.appboycdn.com/web-sdk/2.4/appboy.min.js';
				y.async = 1; (b = p.getElementsByTagName(P)[0]).parentNode.insertBefore(y, b)
			}(window, document, 'script');

			appboy.initialize('470143c2-cb75-4913-a550-ad4a72e19ca6');
			appboy.display.automaticallyShowNewInAppMessages();
			logger(`Braze initalized with key: ${brazeKey}`);
			return;

		};

		pageButton.onclick = (e) => {
			e.preventsDefault;
			analytics.page(`Page Call @ ${new Date().toLocaleTimeString()}`);
			logger(`Page call nothing fancy`);
			return;

		};

		resetButton.onclick = (e) => {
			e.preventsDefault;
			analytics.reset();
			logger('Reset()');
			return;

		};

		identifyAButton.onclick = (e) => {
			e.preventsDefault;
			// analytics.reset();
			id='b1c7ac1c-f70b-1283-268b-d33a5b474dda';
			traits = {
				username: "osama.khan@segment.com",
				score: 99.99
			}
			analytics.identify(id, traits);
			logger(`Identify call for user A w/ id ${id} and traits ${JSON.stringify(traits)}`);
		};

		trackButton.onclick = (e) => {
			e.preventsDefault;
			r = Math.random() * 10
			props = {title:'This is a title', key: 'some value'};
			analytics.track(`User Action #${r}`, props);
			logger(`Track call for random #${r} Action with properties ${props}`);
		}

		identifyBButton.onclick = (e) => {
			e.preventsDefault;
			analytics.reset();
			r = Math.random() * 100;
			id=guid();
			analytics.identify(`${id}`, {
				username: "osama.khan@segment.com",
				score: r
			});
			logger(`Identify call for user B w/ id ${id} and traits ${JSON.stringify({
				username: "osama.khan@segment.com",
				score: r
			})}`);
		};


	</script>

</body>

</html>